---
title: High-Level Design (HLD)
description: Comprehensive architectural overview of the Checkmate Test Case Management System
---

import { Card, CardGrid, Tabs, TabItem, Aside, Steps } from '@astrojs/starlight/components';

## System Overview

Checkmate is a full-stack test case management system built with modern web technologies. It provides a robust platform for managing test cases, organizing test runs, tracking execution status, and generating reports.

### Key Architectural Principles

- **Monolithic Architecture** - Single deployable unit with clear internal separation of concerns
- **Full-Stack React** - Unified codebase using Remix framework
- **Type Safety** - End-to-end TypeScript for reliability
- **Security-First** - RBAC with Casbin, secure authentication
- **API-Driven** - RESTful APIs for external integrations
- **Database-Centric** - MySQL as single source of truth

---

## System Architecture

```mermaid
graph TB
    subgraph Client["Client Layer"]
        Browser["ğŸŒ Browser<br/>(React UI)"]
        Postman["ğŸ“® Postman/cURL"]
        External["ğŸ”Œ External Integrations<br/>(CI/CD, Scripts)"]
    end
    
    subgraph AppServer["Application Server (Remix + Node.js)"]
        subgraph Presentation["Presentation Layer"]
            React["React Components"]
            Routes["Remix Routes (SSR)"]
            State["Client-Side State"]
        end
        
        subgraph BusinessLogic["Business Logic Layer"]
            Controllers["Data Controllers"]
            Services["Service Layer<br/>(Auth, RBAC, Config)"]
            Validation["Validation Layer<br/>(Zod Schemas)"]
        end
        
        subgraph DataAccess["Data Access Layer"]
            ORM["Drizzle ORM"]
            DAO["DAO"]
            DBClient["Database Client"]
        end
    end
    
    subgraph Database["Database Layer"]
        MySQL["ğŸ—„ï¸ MySQL Database<br/>â€¢ Tests, Projects, Runs<br/>â€¢ Users, Organizations<br/>â€¢ Labels, Sections, Squads"]
    end
    
    subgraph ExternalServices["External Services"]
        OAuth["ğŸ” Google OAuth 2.0<br/>(Authentication)"]
        Casbin["ğŸ›¡ï¸ Casbin<br/>(Authorization)"]
    end
    
    Browser -->|HTTPS| Presentation
    Postman -->|HTTPS| Presentation
    External -->|HTTPS| Presentation
    
    Presentation --> BusinessLogic
    BusinessLogic --> DataAccess
    DataAccess --> MySQL
    
    BusinessLogic -.->|Auth| OAuth
    BusinessLogic -.->|RBAC| Casbin
    
    style Client fill:#e1f5ff
    style AppServer fill:#fff4e6
    style Database fill:#f3e5f5
    style ExternalServices fill:#e8f5e9
```

---

## Technology Stack

### Frontend Layer

| Technology | Purpose | Version |
|------------|---------|---------|
| **Remix** | Full-stack React framework with SSR | Latest |
| **React** | UI component library | 18.x |
| **TypeScript** | Type-safe JavaScript | 5.x |
| **shadcn/ui** | Modern UI component library | Latest |
| **TailwindCSS** | Utility-first CSS framework | 3.x |
| **TanStack Table** | Advanced data table functionality | v8 |
| **Zod** | Schema validation | Latest |

### Backend Layer

| Technology | Purpose | Version |
|------------|---------|---------|
| **Node.js** | JavaScript runtime | 18.x+ |
| **Remix** | Server-side rendering & routing | Latest |
| **Drizzle ORM** | Type-safe database ORM | Latest |
| **MySQL** | Relational database | 8.x |
| **Casbin** | RBAC authorization framework | Latest |
| **Remix-Auth** | Authentication library | Latest |

### Infrastructure

| Technology | Purpose |
|------------|---------|
| **Docker** | Containerization |
| **Docker Compose** | Multi-container orchestration |
| **Vite** | Build tool and dev server |
| **Jest** | Testing framework |

---

## Application Architecture

### Layer Breakdown

#### 1. Presentation Layer (`app/`)

**Responsibilities:**
- Render UI components
- Handle user interactions
- Client-side routing
- Form management
- State management

**Key Directories:**
```
app/
â”œâ”€â”€ components/        # Reusable UI components
â”œâ”€â”€ screens/           # Page-level components
â”œâ”€â”€ ui/               # shadcn/ui primitives
â”œâ”€â”€ routes/           # Remix route handlers
â””â”€â”€ styles/           # Global styles
```

**Component Hierarchy:**
```
Root Layout (app/root.tsx)
â”œâ”€â”€ Header Component
â”‚   â”œâ”€â”€ App Logo & Navigation
â”‚   â”œâ”€â”€ User Profile Dropdown
â”‚   â””â”€â”€ Logout Button
â”œâ”€â”€ Main Content Area
â”‚   â”œâ”€â”€ Projects Page
â”‚   â”œâ”€â”€ Tests Page
â”‚   â”‚   â”œâ”€â”€ Test List
â”‚   â”‚   â”œâ”€â”€ Test Filters
â”‚   â”‚   â”œâ”€â”€ Section Tree
â”‚   â”‚   â””â”€â”€ Test Detail Panel
â”‚   â”œâ”€â”€ Runs Page
â”‚   â”‚   â”œâ”€â”€ Run List
â”‚   â”‚   â”œâ”€â”€ Run Filters
â”‚   â”‚   â””â”€â”€ Run Detail View
â”‚   â””â”€â”€ Admin Panel
â””â”€â”€ Footer (if applicable)
```

#### 2. Business Logic Layer (`app/dataController/`)

**Responsibilities:**
- Implement business rules
- Validate data
- Orchestrate operations
- Transform data

**Controllers:**
```typescript
app/dataController/
â”œâ”€â”€ projects.controller.ts      # Project CRUD operations
â”œâ”€â”€ tests.controller.ts          # Test case management
â”œâ”€â”€ runs.controller.ts           # Test run management
â”œâ”€â”€ users.controller.ts          # User management
â”œâ”€â”€ labels.controller.ts         # Label operations
â”œâ”€â”€ sections.controller.ts       # Section hierarchy
â”œâ”€â”€ squads.controller.ts         # Squad management
â”œâ”€â”€ priority.controller.ts       # Priority configuration
â”œâ”€â”€ platform.controller.ts       # Platform configuration
â”œâ”€â”€ automationStatus.controller.ts
â”œâ”€â”€ testCoveredBy.controller.ts
â”œâ”€â”€ type.controller.ts
â””â”€â”€ utils.ts                     # Shared utilities
```

**Example Controller Flow:**
```typescript
// tests.controller.ts
export class TestsController {
  // 1. Receive request from route
  async createTest(data: CreateTestInput) {
    // 2. Validate input (Zod schema)
    const validated = CreateTestSchema.parse(data);
    
    // 3. Check authorization (Casbin)
    await checkAccess(user, 'test', 'create');
    
    // 4. Business logic
    const test = await TestsDAO.create(validated);
    
    // 5. Return response
    return { data: test, status: 201 };
  }
}
```

#### 3. Service Layer (`app/services/`)

**Responsibilities:**
- Cross-cutting concerns
- Authentication & authorization
- Configuration management
- Error handling

**Services:**
```
app/services/
â”œâ”€â”€ auth/                        # Authentication services
â”‚   â”œâ”€â”€ Auth.server.ts          # Auth logic
â”‚   â”œâ”€â”€ session.ts              # Session management
â”‚   â””â”€â”€ interfaces.ts           # Auth types
â”œâ”€â”€ rbac/                        # Authorization services
â”‚   â”œâ”€â”€ roles.ts                # Role definitions
â”‚   â”œâ”€â”€ enforcer.ts             # Casbin enforcer
â”‚   â””â”€â”€ rbacPolicyGeneration.ts # Policy generation
â”œâ”€â”€ config.ts                    # Environment config
â””â”€â”€ ErrorTypes.ts                # Error definitions
```

#### 4. Data Access Layer (`app/db/`)

**Responsibilities:**
- Database operations
- Query building
- Data mapping
- Connection management

**Structure:**
```
app/db/
â”œâ”€â”€ client.ts                    # Drizzle client setup
â”œâ”€â”€ schema/                      # Database schemas
â”‚   â”œâ”€â”€ tests.ts
â”‚   â”œâ”€â”€ projects.ts
â”‚   â”œâ”€â”€ runs.ts
â”‚   â”œâ”€â”€ users.ts
â”‚   â”œâ”€â”€ organization.ts
â”‚   â”œâ”€â”€ labels.ts
â”‚   â””â”€â”€ ...
â””â”€â”€ dao/                         # Data Access Objects
    â”œâ”€â”€ tests.dao.ts
    â”œâ”€â”€ projects.dao.ts
    â”œâ”€â”€ runs.dao.ts
    â””â”€â”€ ...
```

**DAO Pattern Example:**
```typescript
// tests.dao.ts
export class TestsDAO {
  static async findById(testId: number) {
    return await db
      .select()
      .from(tests)
      .where(eq(tests.testId, testId))
      .limit(1);
  }
  
  static async create(data: InsertTest) {
    return await db
      .insert(tests)
      .values(data)
      .returning();
  }
}
```

---

## Request Flow

### 1. User Request Flow (Web Interface)

```mermaid
sequenceDiagram
    participant Browser
    participant ReactComponent as React Component
    participant RemixRoute as Remix Route
    participant Auth as Authentication & Authorization
    participant Controller as Data Controller
    participant DAO
    participant Database as MySQL Database
    
    Browser->>ReactComponent: 1. User Action (click, submit)
    ReactComponent->>RemixRoute: 2. Form submission / useFetcher
    RemixRoute->>Auth: 3. Check session/token
    Auth->>Auth: 4. Casbin RBAC check
    Auth->>Controller: 5. Validate permissions âœ“
    Controller->>Controller: 6. Business logic & validation
    Controller->>DAO: 7. Execute query
    DAO->>Database: 8. SQL query
    Database-->>DAO: 9. Return data
    DAO-->>Controller: 10. Data
    Controller-->>RemixRoute: 11. Formatted response
    RemixRoute-->>ReactComponent: 12. JSON response
    ReactComponent-->>Browser: 13. Update UI
```

### 2. API Request Flow (External Integration)

```mermaid
sequenceDiagram
    participant External as External API<br/>(CI/CD, Postman, cURL)
    participant API as API Endpoint
    participant Auth as getUserAndCheckAccess
    participant Casbin as Casbin Enforcer
    participant Controller
    participant DAO
    participant DB as MySQL

    External->>API: 1. HTTP Request + Bearer Token
    API->>Auth: 2. Validate token
    Auth->>Casbin: 3. Check permissions
    Casbin-->>Auth: 4. Permission result
    alt Permission Denied
        Auth-->>API: 403 Forbidden
        API-->>External: Error response
    else Permission Granted
        Auth->>Controller: 5. Execute business logic
        Controller->>DAO: 6. Data operations
        DAO->>DB: 7. SQL query
        DB-->>DAO: 8. Data
        DAO-->>Controller: 9. Results
        Controller-->>API: 10. Response data
        API-->>External: 11. JSON response
    end
```

---

## Database Design

### Entity Relationship Overview

```mermaid
erDiagram
    Organization ||--o{ Projects : "has"
    Organization ||--o{ Users : "has"
    Users ||--o{ Tokens : "generates"
    Projects ||--o{ Tests : "contains"
    Projects ||--o{ Runs : "has"
    
    Tests }o--o{ Runs : "included in"
    Tests }o--|| Sections : "belongs to"
    Tests }o--|| Priorities : "has"
    Tests }o--|| AutomationStatus : "has"
    Tests }o--o{ Labels : "tagged with"
    Tests }o--o{ Squads : "assigned to"
    Tests }o--o{ Platforms : "runs on"
    
    Runs ||--o{ TestRunMapping : "tracks"
    Tests ||--o{ TestRunMapping : "mapped in"
    
    Organization {
        int orgId PK
        string orgName
        timestamp createdOn
    }
    
    Projects {
        int projectId PK
        string projectName
        int orgId FK
        string description
        boolean isArchived
        int createdBy FK
        timestamp createdOn
    }
    
    Tests {
        int testId PK
        string title
        string description
        int projectId FK
        int sectionId FK
        int priorityId FK
        int automationStatusId FK
        text steps
        text expectedResult
        int createdBy FK
    }
    
    Runs {
        int runId PK
        string runName
        int projectId FK
        boolean isLocked
        int lockedBy FK
        int createdBy FK
        timestamp createdOn
    }
    
    TestRunMapping {
        int mappingId PK
        int runId FK
        int testId FK
        enum status "Passed, Failed, Blocked, Untested, Retest"
        int testedBy FK
        timestamp testedOn
        text comment
    }
    
    Users {
        int userId PK
        string email
        string firstName
        string lastName
        enum role "admin, user, reader"
        string ssoId
        int orgId FK
    }
    
    Tokens {
        int tokenId PK
        string token
        int userId FK
        timestamp createdAt
    }
```

### Core Tables

#### **Projects**
```sql
projects
â”œâ”€â”€ projectId (PK)
â”œâ”€â”€ projectName
â”œâ”€â”€ orgId (FK â†’ organizations)
â”œâ”€â”€ description
â”œâ”€â”€ createdBy (FK â†’ users)
â”œâ”€â”€ createdOn
â”œâ”€â”€ updatedBy
â”œâ”€â”€ updatedOn
â””â”€â”€ isArchived
```

#### **Tests**
```sql
tests
â”œâ”€â”€ testId (PK)
â”œâ”€â”€ title
â”œâ”€â”€ description
â”œâ”€â”€ projectId (FK â†’ projects)
â”œâ”€â”€ sectionId (FK â†’ sections)
â”œâ”€â”€ priorityId (FK â†’ priorities)
â”œâ”€â”€ automationStatusId (FK â†’ automation_status)
â”œâ”€â”€ testCoveredBy
â”œâ”€â”€ preCondition
â”œâ”€â”€ steps
â”œâ”€â”€ expectedResult
â”œâ”€â”€ testData
â”œâ”€â”€ link
â”œâ”€â”€ createdBy (FK â†’ users)
â”œâ”€â”€ createdOn
â”œâ”€â”€ updatedBy
â””â”€â”€ updatedOn
```

#### **Runs**
```sql
runs
â”œâ”€â”€ runId (PK)
â”œâ”€â”€ runName
â”œâ”€â”€ projectId (FK â†’ projects)
â”œâ”€â”€ isLocked
â”œâ”€â”€ lockedBy (FK â†’ users)
â”œâ”€â”€ lockedOn
â”œâ”€â”€ createdBy (FK â†’ users)
â””â”€â”€ createdOn
```

#### **Test Run Mapping** (Status Tracking)
```sql
test_run_mapping
â”œâ”€â”€ mappingId (PK)
â”œâ”€â”€ runId (FK â†’ runs)
â”œâ”€â”€ testId (FK â†’ tests)
â”œâ”€â”€ status (Passed/Failed/Blocked/Untested/Retest)
â”œâ”€â”€ testedBy (FK â†’ users)
â”œâ”€â”€ testedOn
â””â”€â”€ comment
```

#### **Users**
```sql
users
â”œâ”€â”€ userId (PK)
â”œâ”€â”€ email
â”œâ”€â”€ firstName
â”œâ”€â”€ lastName
â”œâ”€â”€ role (admin/user/reader)
â”œâ”€â”€ ssoId (Google OAuth ID)
â”œâ”€â”€ orgId (FK â†’ organizations)
â”œâ”€â”€ createdOn
â””â”€â”€ updatedOn
```

### Database Relationships

- **1:N** - Organization â†’ Projects
- **1:N** - Organization â†’ Users
- **1:N** - Projects â†’ Tests
- **1:N** - Projects â†’ Runs
- **N:M** - Tests â†” Runs (via test_run_mapping)
- **N:M** - Tests â†” Labels (via test_labels_mapping)
- **N:M** - Tests â†” Squads (via test_squads_mapping)
- **N:M** - Tests â†” Platforms (via test_platforms_mapping)

---

## Authentication & Authorization

### Authentication Flow

```mermaid
flowchart TD
    A[ğŸ§‘ User] -->|1. Navigate to /login| B[Login Page]
    B -->|2. Click 'Sign in with Google'| C[ğŸ” Google OAuth 2.0]
    C -->|3. User authenticates| D[Google returns profile]
    D -->|4. Profile data| E[Remix Auth Handler<br/>/callback]
    E -->|5. Check user exists?| F{User in DB?}
    F -->|No| G[Create new user]
    F -->|Yes| H[Get existing user]
    G --> I[Assign default role<br/>reader]
    H --> I
    I -->|6. User record| J[Create Session]
    J -->|7. Set HTTP-only cookie| K[user_session]
    K -->|8. Redirect| L[âœ… Dashboard<br/>Authenticated]
    
    style A fill:#e3f2fd
    style C fill:#fff3e0
    style E fill:#f3e5f5
    style J fill:#e8f5e9
    style L fill:#c8e6c9
```

### Authorization (RBAC with Casbin)

**Role Hierarchy:**
```
admin (Full Access)
  â””â”€â”€ All operations on all resources
  
user (Read & Write)
  â”œâ”€â”€ Create/Update tests, runs, labels
  â””â”€â”€ Cannot delete or manage users
  
reader (Read Only)
  â””â”€â”€ View-only access to all resources
```

**Permission Model:**
```
[request_definition]
r = sub, obj, act

[policy_definition]
p = sub, obj, act

[role_definition]
g = _, _

[policy_effect]
e = some(where (p.eft == allow))

[matchers]
m = g(r.sub, p.sub) && r.obj == p.obj && r.act == p.act
```

**Permission Check Flow:**
```typescript
// In every protected route
async function checkPermission(userId, resource, action) {
  const user = await getUser(userId);
  const allowed = await enforcer.enforce(
    user.role,    // sub: admin/user/reader
    resource,     // obj: project/test/run
    action        // act: create/read/update/delete
  );
  
  if (!allowed) throw new ForbiddenError();
}
```

---

## API Architecture

### RESTful Design

**Endpoint Structure:**
```
/api/v1/{resource}/{action}
```

**HTTP Methods:**
- `GET` - Retrieve resources
- `POST` - Create resources
- `PUT` - Update resources
- `DELETE` - Remove resources

### API Layers

```mermaid
flowchart TD
    A[ğŸ“¡ API Endpoint<br/>/api/v1/test/create] --> B[ğŸ” Authentication<br/>Token/Session validation]
    B --> C[ğŸ›¡ï¸ Authorization<br/>RBAC permission check]
    C --> D[âœ… Input Validation<br/>Zod schema validation]
    D --> E[âš™ï¸ Business Logic<br/>Controller]
    E --> F[ğŸ—„ï¸ Data Access<br/>DAO]
    F --> G[ğŸ“¦ Response Handler<br/>Formatted JSON]
    
    style A fill:#e3f2fd
    style B fill:#fff3e0
    style C fill:#fce4ec
    style D fill:#e8f5e9
    style E fill:#f3e5f5
    style F fill:#e0f2f1
    style G fill:#fff9c4
```

### API Response Format

**Success Response:**
```json
{
  "data": {
    // Resource data
  },
  "status": 200
}
```

**Error Response:**
```json
{
  "error": "Error message",
  "status": 400
}
```

### Rate Limiting & Security

- **Authentication Required** - All endpoints except `/login` and `/callback`
- **RBAC Enforcement** - Every protected route checks permissions
- **Input Validation** - Zod schemas validate all inputs
- **SQL Injection Protection** - Drizzle ORM parameterized queries
- **XSS Protection** - React escapes output by default
- **CSRF Protection** - SameSite cookies + HTTP-only

---

## Component Architecture

### Screen Components

```
app/screens/
â”œâ”€â”€ Projects/
â”‚   â”œâ”€â”€ Projects.tsx           # Project list (card grid)
â”‚   â””â”€â”€ ProjectCard.tsx        # Individual project card
â”œâ”€â”€ TestList/
â”‚   â”œâ”€â”€ TestListPage.tsx       # Test list orchestrator
â”‚   â”œâ”€â”€ TestList.tsx           # DataTable wrapper
â”‚   â”œâ”€â”€ TestColumnConfig.tsx   # Column definitions
â”‚   â”œâ”€â”€ TestListFilters.tsx    # Filter controls
â”‚   â”œâ”€â”€ UploadDownloadButton.tsx
â”‚   â”œâ”€â”€ ProjectActions.tsx
â”‚   â””â”€â”€ TestDetailSlidingPanel.tsx
â”œâ”€â”€ RunTable/
â”‚   â”œâ”€â”€ RunListPage.tsx        # Run list orchestrator
â”‚   â”œâ”€â”€ RunsList.tsx           # DataTable wrapper
â”‚   â””â”€â”€ RunListColumnConfig.tsx
â”œâ”€â”€ RunTestList/
â”‚   â”œâ”€â”€ RunTestList.tsx        # Run detail view
â”‚   â”œâ”€â”€ RunPageTitle.tsx
â”‚   â”œâ”€â”€ RunMetaData.tsx
â”‚   â”œâ”€â”€ RunActions.tsx
â”‚   â””â”€â”€ AddResultDialog.tsx
â”œâ”€â”€ TestDetail/
â”‚   â”œâ”€â”€ TestDetailsPage.tsx    # Test detail view
â”‚   â””â”€â”€ TestStatusHistroyDialog.tsx
â”œâ”€â”€ CreateTest/
â”‚   â”œâ”€â”€ EditTestPage.tsx       # Create/Edit test
â”‚   â”œâ”€â”€ EditTestComponents.tsx
â”‚   â””â”€â”€ EditTestOptionsDropdown.tsx
â””â”€â”€ AdminPanel/
    â””â”€â”€ AdminPanel.tsx         # User management
```

### Reusable Components

```
app/components/
â”œâ”€â”€ DataTable/
â”‚   â”œâ”€â”€ DataTable.tsx          # Generic table component
â”‚   â””â”€â”€ Pagination.tsx         # Pagination controls
â”œâ”€â”€ SectionList/
â”‚   â”œâ”€â”€ SectionList.tsx        # Hierarchical tree
â”‚   â”œâ”€â”€ RenderSections.tsx     # Recursive rendering
â”‚   â”œâ”€â”€ SectionInfoBox.tsx
â”‚   â””â”€â”€ AddSectionDialog.tsx
â”œâ”€â”€ MultipleUnifiedFilter/
â”‚   â”œâ”€â”€ MultipleUnifiedFilter.tsx  # Advanced filtering
â”‚   â””â”€â”€ FilterDropdown.tsx
â”œâ”€â”€ Header/
â”‚   â”œâ”€â”€ AppHeader.tsx          # Main header
â”‚   â””â”€â”€ UserComponent.tsx      # User dropdown
â”œâ”€â”€ Dialog/
â”‚   â”œâ”€â”€ Dialog.tsx             # Custom dialog
â”‚   â””â”€â”€ StateDialog.tsx        # Stateful dialog
â”œâ”€â”€ SearchBar/
â”‚   â””â”€â”€ SearchBar.tsx          # Search input
â”œâ”€â”€ CustomDrawer.tsx           # Sliding panel
â”œâ”€â”€ Loader/
â”‚   â””â”€â”€ Loader.tsx             # Loading spinner
â””â”€â”€ ErrorBoundry/
    â””â”€â”€ ErrorBoundry.tsx       # Error handling
```

---

## Deployment Architecture

### Docker Setup

```yaml
# docker-compose.yml
services:
  checkmate-db:
    image: mysql:8
    volumes:
      - db_data:/var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD
      - MYSQL_DATABASE
    
  db_seeder:
    depends_on:
      - checkmate-db
    command: seed database
    
  checkmate-app:
    build: .
    ports:
      - "3000:3000"
    depends_on:
      - checkmate-db
    environment:
      - DATABASE_URL
      - GOOGLE_CLIENT_ID
      - GOOGLE_CLIENT_SECRET
```

### Container Structure

```mermaid
graph LR
    subgraph Docker["Docker Compose"]
        subgraph App["checkmate-app Container"]
            NodeApp["ğŸš€ Node.js + Remix<br/>Port: 3000"]
        end
        
        subgraph DB["checkmate-db Container"]
            MySQL["ğŸ—„ï¸ MySQL 8<br/>Port: 3306<br/>Volume: db_data"]
        end
        
        subgraph Seeder["db_seeder Container"]
            Seed["ğŸŒ± Database Seeder<br/>Initial data"]
        end
    end
    
    App -->|SQL Queries| DB
    Seeder -.->|Seeds data| DB
    
    Client[ğŸŒ Browser<br/>localhost:3000] -->|HTTP| App
    
    style App fill:#e3f2fd
    style DB fill:#f3e5f5
    style Seeder fill:#e8f5e9
    style Client fill:#fff3e0
```

### Build Process

```bash
# Dockerfile
FROM node:18-alpine

WORKDIR /app

# Install dependencies
COPY package.json yarn.lock ./
RUN yarn install --frozen-lockfile

# Copy source code
COPY . .

# Build application
RUN yarn build

# Expose port
EXPOSE 3000

# Start server
CMD ["yarn", "start"]
```

---

## Data Flow Patterns

### 1. List Page Pattern (Projects, Tests, Runs)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Page Load    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Loader Function  â”‚  (Server-side data fetch)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Render Page      â”‚  (SSR initial render)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Interaction â”‚  (Filter, Search, Page)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ useFetcher       â”‚  (Client-side fetch)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update State     â”‚  (Re-render)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Create/Edit Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Form Display â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Input       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client Validationâ”‚  (Zod schema)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Form Submit      â”‚  (POST/PUT request)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Server Validationâ”‚  (Zod + Business rules)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Database Update  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Redirect/Toast   â”‚  (Success feedback)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Infinite Scroll Pattern (Projects)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Initial Load â”‚  (First page)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Scroll Detection â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Near bottom?
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Fetch Next Page  â”‚  (useFetcher)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Append to List   â”‚  (Concatenate state)
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Continue Scroll  â”‚  (Repeat)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Architecture

### Multi-Layer Security

```mermaid
flowchart TD
    A[ğŸŒ Network Layer] --> B[ğŸ” Authentication Layer]
    B --> C[ğŸ›¡ï¸ Authorization Layer]
    C --> D[âœ… Input Validation Layer]
    D --> E[ğŸ—„ï¸ Data Access Layer]
    
    A1["â€¢ HTTPS (TLS 1.3)<br/>â€¢ Secure Headers<br/>â€¢ CORS Configuration"] -.-> A
    B1["â€¢ Google OAuth 2.0<br/>â€¢ Session Cookies (HTTP-only)<br/>â€¢ API Token (Bearer)"] -.-> B
    C1["â€¢ Casbin RBAC<br/>â€¢ Role-based Permissions<br/>â€¢ Resource-level Access"] -.-> C
    D1["â€¢ Zod Schema Validation<br/>â€¢ Type Checking<br/>â€¢ Sanitization"] -.-> D
    E1["â€¢ Parameterized Queries<br/>â€¢ ORM Protection<br/>â€¢ SQL Injection Prevention"] -.-> E
    
    style A fill:#e3f2fd
    style B fill:#fff3e0
    style C fill:#fce4ec
    style D fill:#e8f5e9
    style E fill:#f3e5f5
```

### Security Measures

<CardGrid>
  <Card title="Authentication" icon="key">
    - Google OAuth 2.0
    - Secure session management
    - API token generation
    - Token rotation support
  </Card>
  
  <Card title="Authorization" icon="shield">
    - Casbin RBAC
    - Fine-grained permissions
    - Role hierarchy
    - Resource-level access
  </Card>
  
  <Card title="Data Protection" icon="lock">
    - Encrypted connections
    - Secure cookies
    - Password-less auth
    - No sensitive data in logs
  </Card>
  
  <Card title="Input Validation" icon="approve-check">
    - Zod schema validation
    - Type checking
    - Sanitization
    - SQL injection prevention
  </Card>
</CardGrid>

---

## Scalability Considerations

### Current Architecture

- **Monolithic Design** - Single deployable unit
- **Vertical Scaling** - Increase container resources
- **Database Optimization** - Indexed queries, connection pooling

### Future Enhancements

1. **Horizontal Scaling**
   - Multiple application instances behind load balancer
   - Session store (Redis) for distributed sessions
   - Database read replicas

2. **Caching Layer**
   - Redis for frequently accessed data
   - CDN for static assets
   - Browser caching strategies

3. **Microservices** (if needed)
   - Authentication service
   - Test execution service
   - Reporting service
   - Notification service

4. **Message Queue**
   - Async processing for bulk operations
   - Background job processing
   - Event-driven architecture

---

## Performance Optimization

### Current Optimizations

1. **Server-Side Rendering (SSR)**
   - Faster initial page load
   - Better SEO
   - Improved perceived performance

2. **Code Splitting**
   - Lazy loading of routes
   - Dynamic imports
   - Smaller bundle sizes

3. **Database Optimization**
   - Indexed columns (projectId, testId, runId, etc.)
   - Pagination for large datasets
   - Optimized queries

4. **Asset Optimization**
   - Image optimization
   - CSS minification
   - JavaScript bundling

### Performance Metrics

| Metric | Target | Current |
|--------|--------|---------|
| Time to First Byte (TTFB) | < 200ms | ~150ms |
| First Contentful Paint (FCP) | < 1.5s | ~1.2s |
| Largest Contentful Paint (LCP) | < 2.5s | ~2.0s |
| Time to Interactive (TTI) | < 3.5s | ~3.0s |

---

## Monitoring & Logging

### Logging Strategy

```typescript
// app/utils/logger.ts
export const logger = {
  info: (message, meta?) => console.log(message, meta),
  error: (message, error?) => console.error(message, error),
  warn: (message, meta?) => console.warn(message, meta),
  debug: (message, meta?) => console.debug(message, meta)
};

// Usage in controllers
logger.info('Test created', { testId, userId });
logger.error('Failed to create test', error);
```

### Error Handling

```typescript
// Centralized error handler
export function errorResponseHandler(error: any) {
  if (error.message === ACCESS_ERROR_MESSAGE) {
    return responseHandler({
      error: 'User does not have access',
      status: 403
    });
  }
  
  logger.error('API Error', error);
  
  return responseHandler({
    error: error.message || 'Internal server error',
    status: error.status || 500
  });
}
```

---

## Testing Strategy

### Test Pyramid

```mermaid
graph TD
    subgraph Pyramid [" "]
        E2E["ğŸŒ E2E Tests<br/>(Few)<br/>End-to-end user flows"]
        Integration["ğŸ”— Integration Tests<br/>(Some)<br/>API endpoints, DB operations"]
        Unit["âš¡ Unit Tests<br/>(Many)<br/>Controllers, utilities, hooks"]
    end
    
    E2E --> Integration
    Integration --> Unit
    
    style E2E fill:#fce4ec
    style Integration fill:#fff3e0
    style Unit fill:#e8f5e9
```

### Current Test Coverage

```
app/
â”œâ”€â”€ dataController/__test__/   # Controller unit tests
â”œâ”€â”€ hooks/__tests__/           # Custom hooks tests
â”œâ”€â”€ utils/__tests__/           # Utility function tests
â””â”€â”€ routes/utilities/__tests__/# Route utility tests
```

### Testing Tools

- **Jest** - Testing framework
- **React Testing Library** - Component testing
- **Supertest** - API endpoint testing
- **BATS** - Bash script testing

---

## Development Workflow

### Local Development

<Steps>
1. **Clone Repository**
   ```bash
   git clone git@github.com:dream-sports-labs/checkmate.git
   cd checkmate
   ```

2. **Install Dependencies**
   ```bash
   yarn install
   ```

3. **Setup Environment**
   ```bash
   cp .env.example .env
   # Configure environment variables
   ```

4. **Start Docker Containers**
   ```bash
   yarn docker:setup
   ```

5. **Access Application**
   - Application: http://localhost:3000
   - Database: localhost:3306
</Steps>

### Code Organization

```
checkmate/
â”œâ”€â”€ app/                    # Application code
â”‚   â”œâ”€â”€ components/        # Reusable components
â”‚   â”œâ”€â”€ screens/          # Page components
â”‚   â”œâ”€â”€ routes/           # Route handlers
â”‚   â”œâ”€â”€ dataController/   # Business logic
â”‚   â”œâ”€â”€ db/              # Database layer
â”‚   â”œâ”€â”€ services/        # Services layer
â”‚   â””â”€â”€ ui/              # UI primitives
â”œâ”€â”€ docs/                 # Documentation site
â”œâ”€â”€ public/              # Static assets
â”œâ”€â”€ scripts/             # Utility scripts
â””â”€â”€ tests/               # Test files
```

---

## API Endpoint Summary

### Resource Categories

| Category | Endpoints | Purpose |
|----------|-----------|---------|
| **Projects** | 5 | Project CRUD operations |
| **Tests** | 7 | Test case management |
| **Runs** | 9 | Test run management |
| **Labels** | 4 | Label management |
| **Sections** | 4 | Section hierarchy |
| **Squads** | 4 | Squad management |
| **Configuration** | 4 | System configuration |
| **Users** | 3 | User management |
| **Authentication** | 2 | Token generation |
| **Reports** | 2 | Data export |

**Total:** 48 API endpoints

---

## Future Roadmap

### Planned Enhancements

1. **Enhanced Reporting**
   - Dashboard with charts
   - Trend analysis
   - Custom report builder

2. **Webhooks**
   - Notify external systems
   - Event-driven integrations
   - Real-time updates

3. **Advanced Filtering**
   - Saved filters
   - Complex query builder
   - Filter templates

4. **Collaboration**
   - Real-time updates (WebSockets)
   - Comments on tests/runs
   - @mentions

5. **Import/Export**
   - Excel import/export
   - JSON export
   - Integration with other TMS

6. **Mobile App**
   - Native iOS/Android
   - React Native
   - Offline support

---

## Conclusion

Checkmate is architected as a modern, full-stack web application with clear separation of concerns, strong type safety, and security-first design principles. The architecture supports current requirements while remaining flexible for future enhancements.

### Key Strengths

âœ… **Type-Safe** - End-to-end TypeScript  
âœ… **Secure** - Multi-layer security with RBAC  
âœ… **Maintainable** - Clean architecture with clear layers  
âœ… **Scalable** - Designed for growth  
âœ… **Developer-Friendly** - Modern tools and practices  
âœ… **API-First** - RESTful APIs for integration  
âœ… **Well-Documented** - Comprehensive documentation  

---

## Additional Resources

- [Application Structure](/project/application-structure)
- [Database Schema](/tech/db-schema)
- [API Documentation](/guides/api)
- [Setup Guide](/project/setup)
- [RBAC Guide](/project/rbac)
